<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fasipe - Agenda MÃ©dica</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0d652d;
      --primary-light: #2e8b57;
      --primary-dark: #094c23;
      --secondary: #4caf50;
      --accent: #81c784;
      --light-bg: #e8f5e9;
      --text-dark: #1b5e20;
      --text-light: #f1f8e9;
      --gray-light: #f5f7fa;
      --border-color: #d1e7dd;
      --success: #388e3c;
      --warning: #f57c00;
      --danger: #d32f2f;
      --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Roboto', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: var(--gray-light);
      color: #333;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Layout Google Calendar */
    .app-container {
      display: grid;
      grid-template-columns: 280px 1fr;
      grid-template-rows: 70px 1fr;
      grid-template-areas: 
        "header header"
        "sidebar main";
      height: 100vh;
    }
    
    /* Header */
    .header {
      grid-area: header;
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      color: white;
      padding: 0 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 1.4rem;
      font-weight: 500;
    }
    
    .logo i {
      font-size: 1.8rem;
    }
    
    .header-center {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .nav-buttons {
      display: flex;
      gap: 5px;
    }
    
    .nav-btn {
      background: rgba(255, 255, 255, 0.15);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    
    .date-display {
      font-size: 1.2rem;
      font-weight: 500;
      padding: 0 15px;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .view-options {
      display: flex;
      gap: 5px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 30px;
      padding: 5px;
    }
    
    .view-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      background: none;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }
    
    .view-btn:hover, .view-btn.active {
      background: white;
      color: var(--primary);
    }
    
    .new-event-btn {
      background: white;
      color: var(--primary);
      border: none;
      padding: 8px 20px;
      border-radius: 30px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      box-shadow: var(--card-shadow);
    }
    
    .new-event-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(13, 101, 45, 0.3);
    }
    
    /* Sidebar */
    .sidebar {
      grid-area: sidebar;
      background-color: white;
      border-right: 1px solid var(--border-color);
      padding: 1.5rem 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    
    .sidebar-section {
      margin-bottom: 2rem;
    }
    
    .sidebar-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      color: var(--primary-dark);
      margin-bottom: 1rem;
      padding-left: 10px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .sidebar-menu {
      list-style: none;
    }
    
    .sidebar-menu li {
      padding: 0.7rem 1rem;
      border-radius: 6px;
      margin-bottom: 0.4rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: var(--transition);
    }
    
    .sidebar-menu li:hover, 
    .sidebar-menu li.active {
      background-color: var(--light-bg);
      color: var(--primary-dark);
    }
    
    .sidebar-menu li i {
      width: 24px;
      text-align: center;
    }
    
    .color-badge {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }
    
    .badge-consulta { background-color: #388e3c; }
    .badge-cirurgia { background-color: #f57c00; }
    .badge-administrativo { background-color: #1976d2; }
    
    /* Mini Calendar */
    .mini-calendar {
      margin-top: auto;
      border-top: 1px solid var(--border-color);
      padding-top: 1.5rem;
    }
    
    .mini-calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      padding: 0 5px;
    }
    
    .mini-calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 3px;
    }
    
    .mini-cal-day {
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 0.85rem;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .mini-cal-day:hover {
      background-color: var(--light-bg);
    }
    
    .mini-cal-day.today {
      background-color: var(--primary);
      color: white;
    }
    
    .mini-cal-day.has-event {
      position: relative;
    }
    
    .mini-cal-day.has-event::after {
      content: '';
      position: absolute;
      width: 4px;
      height: 4px;
      background-color: var(--primary);
      border-radius: 50%;
      bottom: 4px;
    }
    
    .mini-cal-day.other-month {
      color: #aaa;
    }
    
    /* Main Content */
    .main-content {
      grid-area: main;
      padding: 1.5rem;
      overflow-y: auto;
      background-color: var(--gray-light);
      display: flex;
      flex-direction: column;
    }
    
    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      margin-bottom: 5px;
      background: white;
      border-radius: 10px 10px 0 0;
      overflow: hidden;
    }
    
    .calendar-day-header {
      text-align: center;
      padding: 15px 0;
      font-weight: 500;
      color: var(--primary-dark);
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(5, 1fr);
      flex-grow: 1;
      gap: 1px;
      background-color: var(--border-color);
      border: 1px solid var(--border-color);
      border-radius: 0 0 10px 10px;
      overflow: hidden;
    }
    
    .calendar-day {
      background-color: white;
      min-height: 120px;
      position: relative;
      padding: 10px;
    }
    
    .calendar-day.other-month {
      background-color: #e2d8d8;
    }
    
    .calendar-day.today {
      background-color: rgba(76, 175, 80, 0.1);
    }
    
    .day-number {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    .calendar-day.today .day-number {
      background-color: var(--primary);
      color: white;
    }
    
    .day-events {
      margin-top: 30px;
      overflow-y: auto;
      max-height: calc(100% - 30px);
    }
    
    .calendar-event {
      padding: 8px;
      margin-bottom: 5px;
      border-radius: 4px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      position: relative;
      padding-left: 25px;
    }
    
    .calendar-event:hover {
      opacity: 0.9;
      transform: translateX(3px);
    }
    
    .calendar-event::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .event-consulta {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    
    .event-consulta::before {
      background-color: #388e3c;
    }
    
    .event-cirurgia {
      background-color: #fff3e0;
      color: #e65100;
    }
    
    .event-cirurgia::before {
      background-color: #f57c00;
    }
    
    .event-administrativo {
      background-color: #e3f2fd;
      color: #1565c0;
    }
    
    .event-administrativo::before {
      background-color: #1976d2;
    }
    
    /* Event Details Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: white;
      width: 90%;
      max-width: 500px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      animation: modalFade 0.3s ease-out;
    }
    
    @keyframes modalFade {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
      padding: 1.5rem;
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      color: white;
      position: relative;
    }
    
    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .modal-body {
      padding: 1.5rem;
    }
    
    .event-detail {
      display: flex;
      margin-bottom: 1.2rem;
    }
    
    .event-detail i {
      width: 24px;
      color: var(--primary);
      margin-top: 3px;
    }
    
    .event-detail-content {
      flex: 1;
    }
    
    .event-detail-title {
      font-weight: 500;
      color: #555;
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }
    
    .event-detail-value {
      font-size: 1.1rem;
      color: #333;
    }
    
    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    .btn {
      padding: 0.7rem 1.3rem;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      color: white;
    }
    
    .btn-primary:hover {
      background: linear-gradient(to right, var(--primary-dark), var(--primary));
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    .btn-secondary {
      background-color: white;
      color: var(--primary);
      border: 1px solid var(--border-color);
    }
    
    .btn-secondary:hover {
      background-color: var(--light-bg);
    }
    
    /* Responsividade */
    @media (max-width: 900px) {
      .app-container {
        grid-template-columns: 1fr;
        grid-template-areas: 
          "header"
          "main";
      }
      
      .sidebar {
        display: none;
      }
      
      .header {
        padding: 0 1rem;
      }
      
      .date-display {
        display: none;
      }
    }
    
    @media (max-width: 768px) {
      .calendar-day {
        min-height: 100px;
      }
      
      .view-options {
        display: none;
      }
    }
    
    @media (max-width: 480px) {
      .main-content {
        padding: 1rem;
      }
      
      .calendar-day-header {
        font-size: 0.8rem;
        padding: 10px 0;
      }
      
      .day-number {
        width: 24px;
        height: 24px;
        font-size: 0.8rem;
      }
      
      .calendar-event {
        font-size: 0.7rem;
        padding: 5px;
        padding-left: 20px;
      }
    }

    .form-group {
  margin-bottom: 1.2rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #555;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 0.8rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
  transition: var(--transition);
}

.form-group input:focus,
.form-group select:focus {
  border-color: var(--primary);
  outline: none;
  box-shadow: 0 0 0 3px rgba(13, 101, 45, 0.1);
}
  </style>
</head>
<body>
  <div class="app-container">
    <header class="header">
      <div class="logo">
        <i class="fas fa-calendar-check"></i>
        <span>Fasipe - Agenda MÃ©dica</span>
      </div>
      
      <div class="header-center">
        <div class="nav-buttons">
          <button class="nav-btn" id="prevMonth">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="nav-btn" id="todayBtn">
            Hoje
          </button>
          <button class="nav-btn" id="nextMonth">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="date-display" id="currentMonth"></div>
      </div>
      
      <div class="header-right">
        <div class="view-options">
          <button class="view-btn">Dia</button>
          <button class="view-btn">Semana</button>
          <button class="view-btn active">MÃªs</button>
        </div>
        <button class="new-event-btn">
          <i class="fas fa-plus"></i> Criar
        </button>
      </div>
    </header>
    
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Meus CalendÃ¡rios</div>
        <ul class="sidebar-menu">
          <li class="active">
            <i class="fas fa-circle" style="color: #388e3c"></i> 
            Consultas
          </li>
          <li>
            <i class="fas fa-circle" style="color: #f57c00"></i> 
            Cirurgias
          </li>
          <li>
            <i class="fas fa-circle" style="color: #1976d2"></i> 
            Administrativo
          </li>
        </ul>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-title">Filtros</div>
        <form id="filterForm">
          <div class="filter-group">
            <label for="professional">Profissional:</label>
            <select id="professional">
              <option value="">Todos</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="specialty">Especialidade:</label>
            <select id="specialty">
              <option value="">Todas</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="type">Tipo de Evento:</label>
            <select id="type">
              <option value="">Todos</option>
              <option value="consulta">Consulta</option>
              <option value="cirurgia">Cirurgia</option>
              <option value="administrativo">Administrativo</option>
            </select>
          </div>
          
          <button type="button" id="filterButton" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
            <i class="fas fa-filter"></i> Aplicar Filtros
          </button>
        </form>
      </div>
      
      <div class="mini-calendar">
        <div class="mini-calendar-header">
          <span id="miniCalendarMonth"></span>
          <div class="nav-buttons">
            <button class="nav-btn" id="miniPrev">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="nav-btn" id="miniNext">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
        <div class="mini-calendar-grid" id="miniCalendarDays">
          <!-- Dias serÃ£o preenchidos via JS -->
        </div>
      </div>
    </aside>
    
    <main class="main-content">
      <div class="calendar-header">
        <div class="calendar-day-header">Dom</div>
        <div class="calendar-day-header">Seg</div>
        <div class="calendar-day-header">Ter</div>
        <div class="calendar-day-header">Qua</div>
        <div class="calendar-day-header">Qui</div>
        <div class="calendar-day-header">Sex</div>
        <div class="calendar-day-header">SÃ¡b</div>
      </div>
      
      <div class="calendar-grid" id="calendarGrid">
        <!-- Dias serÃ£o preenchidos via JS -->
      </div>
    </main>
  </div>
  
  <!-- Modal de Detalhes do Evento -->
  <div class="modal" id="eventModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalEventTitle">Consulta de Rotina</h3>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="event-detail">
          <i class="fas fa-user-md"></i>
          <div class="event-detail-content">
            <div class="event-detail-title">Profissional</div>
            <div class="event-detail-value" id="modalProfessional">Dra. Eliza</div>
          </div>
        </div>
        
        <div class="event-detail">
          <i class="fas fa-stethoscope"></i>
          <div class="event-detail-content">
            <div class="event-detail-title">Especialidade</div>
            <div class="event-detail-value" id="modalSpecialty">Acupuntura</div>
          </div>
        </div>
        
        <div class="event-detail">
          <i class="fas fa-calendar-day"></i>
          <div class="event-detail-content">
            <div class="event-detail-title">Data</div>
            <div class="event-detail-value" id="modalDate">08/03/2025</div>
          </div>
        </div>
        
        <div class="event-detail">
          <i class="fas fa-clock"></i>
          <div class="event-detail-content">
            <div class="event-detail-title">HorÃ¡rio</div>
            <div class="event-detail-value" id="modalTime">09:00</div>
          </div>
        </div>
        
        <div class="event-detail">
          <i class="fas fa-tag"></i>
          <div class="event-detail-content">
            <div class="event-detail-title">Tipo</div>
            <div class="event-detail-value" id="modalType">Consulta</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary">
          <i class="fas fa-edit"></i> Editar
        </button>
        <button class="btn btn-primary">
          <i class="fas fa-check"></i> Confirmar
        </button>
      </div>
    </div>
  </div>
  <!-- Modal de CriaÃ§Ã£o de Evento -->
<div class="modal" id="createEventModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Novo Agendamento</h3>
      <button class="modal-close" id="closeCreateModal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="eventForm">
        <div class="form-group">
          <label for="eventTitle">TÃ­tulo</label>
          <input type="text" id="eventTitle" required>
        </div>
        
        <div class="form-group">
          <label for="eventProfessional">Profissional</label>
          <select id="eventProfessional" required>
            <option value="">Selecione...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="eventSpecialty">Especialidade</label>
          <input type="text" id="eventSpecialty" required>
        </div>
        
        <div class="form-group">
          <label for="eventDate">Data</label>
          <input type="date" id="eventDate" required>
        </div>
        
        <div class="form-group">
          <label for="eventTime">HorÃ¡rio</label>
          <input type="time" id="eventTime" required>
        </div>
        
        <div class="form-group">
          <label for="eventType">Tipo</label>
          <select id="eventType" required>
            <option value="consulta">Consulta</option>
            <option value="cirurgia">Cirurgia</option>
            <option value="administrativo">Administrativo</option>
          </select>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" id="cancelCreate">
        Cancelar
      </button>
      <button class="btn btn-primary" id="saveEvent">
        <i class="fas fa-save"></i> Salvar
      </button>
    </div>
  </div>
</div>
  
  <script>
  // VariÃ¡veis globais
let currentDate = new Date();
let events = [];
let filteredEvents = [];

// Elementos DOM
const calendarGrid = document.getElementById('calendarGrid');
const currentMonthEl = document.getElementById('currentMonth');
const prevMonthBtn = document.getElementById('prevMonth');
const nextMonthBtn = document.getElementById('nextMonth');
const todayBtn = document.getElementById('todayBtn');
const eventModal = document.getElementById('eventModal');
const closeModal = document.getElementById('closeModal');
const createEventModal = document.getElementById('createEventModal');
const newEventBtn = document.querySelector('.new-event-btn');
const closeCreateModal = document.getElementById('closeCreateModal');
const cancelCreateBtn = document.getElementById('cancelCreate');
const saveEventBtn = document.getElementById('saveEvent');
const eventForm = document.getElementById('eventForm');

// FunÃ§Ãµes utilitÃ¡rias
function formatDate(dateString) {
  const date = new Date(dateString);
  return date.toLocaleDateString('pt-BR');
}

function getDaysInMonth(year, month) {
  return new Date(year, month + 1, 0).getDate();
}

function getFirstDayOfMonth(year, month) {
  return new Date(year, month, 1).getDay();
}

function formatMonthYear(date) {
  const options = { year: 'numeric', month: 'long' };
  return date.toLocaleDateString('pt-BR', options);
}

// Carregar eventos do servidor
async function loadEvents() {
  try {
    const response = await fetch('/api/events');
    if (!response.ok) {
      throw new Error(`Erro HTTP: ${response.status}`);
    }
    const data = await response.json();
    events = data;
    filteredEvents = [...events];
    populateFilters();
    renderCalendar();
  } catch (error) {
    console.error('Erro ao carregar eventos:', error);
    alert('Erro ao carregar eventos. Verifique a conexÃ£o com o servidor.');
  }
}

// Renderizar calendÃ¡rio
function renderCalendar() {
  calendarGrid.innerHTML = '';
  currentMonthEl.textContent = formatMonthYear(currentDate);
  
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const daysInMonth = getDaysInMonth(year, month);
  const firstDayIndex = getFirstDayOfMonth(year, month);
  
  // Dias do mÃªs anterior
  const prevMonthDays = getDaysInMonth(year, month - 1);
  for (let i = prevMonthDays - firstDayIndex + 1; i <= prevMonthDays; i++) {
    const dayEl = document.createElement('div');
    dayEl.className = 'calendar-day other-month';
    dayEl.innerHTML = `<div class="day-number">${i}</div>`;
    calendarGrid.appendChild(dayEl);
  }
  
  // Dias do mÃªs atual
  const today = new Date();
  for (let i = 1; i <= daysInMonth; i++) {
    const dayEl = document.createElement('div');
    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
    
    // Verificar se Ã© hoje
    const isToday = today.getDate() === i && 
                    today.getMonth() === month && 
                    today.getFullYear() === year;
    
    dayEl.className = `calendar-day ${isToday ? 'today' : ''}`;
    dayEl.innerHTML = `<div class="day-number">${i}</div>`;
    
    // Adicionar eventos para este dia
    const dayEvents = filteredEvents.filter(event => event.date === dateStr);
    if (dayEvents.length > 0) {
      const eventsContainer = document.createElement('div');
      eventsContainer.className = 'day-events';
      
      dayEvents.forEach(event => {
        const eventEl = document.createElement('div');
        eventEl.className = `calendar-event event-${event.type}`;
        eventEl.textContent = `${event.time} - ${event.title}`;
        eventEl.dataset.id = event.id;
        
        // Tooltip com informaÃ§Ãµes completas
        eventEl.setAttribute('title', `${event.title}\nProfissional: ${event.professional}\nEspecialidade: ${event.specialty}`);
        
        eventEl.addEventListener('click', () => {
          showEventDetails(event.id);
        });
        
        eventsContainer.appendChild(eventEl);
      });
      
      dayEl.appendChild(eventsContainer);
    }
    
    calendarGrid.appendChild(dayEl);
  }
  
  // Dias do prÃ³ximo mÃªs (para completar a grade)
  const totalCells = 42; // 6 semanas * 7 dias
  const daysSoFar = firstDayIndex + daysInMonth;
  const nextMonthDays = totalCells - daysSoFar;
  
  for (let i = 1; i <= nextMonthDays; i++) {
    const dayEl = document.createElement('div');
    dayEl.className = 'calendar-day other-month';
    dayEl.innerHTML = `<div class="day-number">${i}</div>`;
    calendarGrid.appendChild(dayEl);
  }
}

// Mostrar detalhes do evento
function showEventDetails(eventId) {
  const event = events.find(e => e.id == eventId);
  if (!event) return;
  
  document.getElementById('modalEventTitle').textContent = event.title;
  document.getElementById('modalProfessional').textContent = event.professional;
  document.getElementById('modalSpecialty').textContent = event.specialty || 'NÃ£o informado';
  document.getElementById('modalDate').textContent = formatDate(event.date);
  document.getElementById('modalTime').textContent = event.time;
  document.getElementById('modalType').textContent = event.type.charAt(0).toUpperCase() + event.type.slice(1);
  
  eventModal.style.display = 'flex';
}

// Popular filtros
function populateFilters() {
  const professionalSelect = document.getElementById("professional");
  const specialtySelect = document.getElementById("specialty");
  
  // Limpar opÃ§Ãµes existentes (exceto "Todos")
  professionalSelect.innerHTML = '<option value="">Todos</option>';
  specialtySelect.innerHTML = '<option value="">Todas</option>';
  
  // Extrair valores Ãºnicos
  const professionals = [...new Set(events.map(ev => ev.professional))];
  const specialties = [...new Set(events.map(ev => ev.specialty).filter(s => s))];
  
  // Preencher as opÃ§Ãµes dos filtros
  professionals.forEach(prof => {
    const option = document.createElement("option");
    option.value = prof;
    option.textContent = prof;
    professionalSelect.appendChild(option);
  });
  
  specialties.forEach(spec => {
    const option = document.createElement("option");
    option.value = spec;
    option.textContent = spec;
    specialtySelect.appendChild(option);
  });
  
  // Popular select do formulÃ¡rio de criaÃ§Ã£o
  const eventProfessionalSelect = document.getElementById("eventProfessional");
  eventProfessionalSelect.innerHTML = '<option value="">Selecione...</option>';
  professionals.forEach(prof => {
    const option = document.createElement("option");
    option.value = prof;
    option.textContent = prof;
    eventProfessionalSelect.appendChild(option);
  });
}

// Filtrar eventos
function filterEvents() {
  const professionalFilter = document.getElementById("professional").value;
  const specialtyFilter = document.getElementById("specialty").value;
  const typeFilter = document.getElementById("type").value;
  
  filteredEvents = events.filter(ev => {
    const matchProfessional = professionalFilter ? ev.professional === professionalFilter : true;
    const matchSpecialty = specialtyFilter ? ev.specialty === specialtyFilter : true;
    const matchType = typeFilter ? ev.type === typeFilter : true;
    
    return matchProfessional && matchSpecialty && matchType;
  });
  
  renderCalendar();
}

// Salvar novo evento
async function saveEvent() {
  const newEvent = {
    title: document.getElementById('eventTitle').value.trim(),
    professional: document.getElementById('eventProfessional').value,
    specialty: document.getElementById('eventSpecialty').value.trim(),
    date: document.getElementById('eventDate').value,
    time: document.getElementById('eventTime').value,
    type: document.getElementById('eventType').value
  };

  // ValidaÃ§Ã£o
  if (!newEvent.title || !newEvent.professional || !newEvent.date || !newEvent.time || !newEvent.type) {
    alert('Por favor, preencha todos os campos obrigatÃ³rios!');
    return;
  }

  try {
    const response = await fetch('/api/events', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(newEvent)
    });

    if (!response.ok) {
      throw new Error(`Erro HTTP: ${response.status}`);
    }

    const savedEvent = await response.json();
    events.push(savedEvent);
    filteredEvents = [...events];
    populateFilters();
    renderCalendar();
    createEventModal.style.display = 'none';
    eventForm.reset();
    alert('Evento criado com sucesso!');
    
  } catch (error) {
    console.error('Erro ao salvar evento:', error);
    alert('Erro ao salvar evento. Verifique a conexÃ£o com o servidor.');
  }
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
  loadEvents();

  // NavegaÃ§Ã£o do calendÃ¡rio
  prevMonthBtn.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });
  
  nextMonthBtn.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });
  
  todayBtn.addEventListener('click', () => {
    currentDate = new Date();
    renderCalendar();
  });
  
  // Modal de eventos
  closeModal.addEventListener('click', () => {
    eventModal.style.display = 'none';
  });
  
  // Modal de criaÃ§Ã£o
  newEventBtn.addEventListener('click', () => {
    createEventModal.style.display = 'flex';
  });
  
  closeCreateModal.addEventListener('click', () => {
    createEventModal.style.display = 'none';
  });
  
  cancelCreateBtn.addEventListener('click', () => {
    createEventModal.style.display = 'none';
  });
  
  saveEventBtn.addEventListener('click', saveEvent);
  
  // Filtros
  document.getElementById('filterButton').addEventListener('click', filterEvents);
  
  // Fechar modal clicando fora
  window.addEventListener('click', (e) => {
    if (e.target === eventModal) {
      eventModal.style.display = 'none';
    }
    if (e.target === createEventModal) {
      createEventModal.style.display = 'none';
    }
  });
});
    // FunÃ§Ã£o para carregar profissionais no select
async function loadEvents() {
  try {
    const response = await fetch('/api/agenda'); // Endpoint corrigido
    if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
    
    const data = await response.json();
    events = data.map(event => ({
      ...event,
      professional: event.professionalName // Mapeia o nome do profissional
    }));
    
    filteredEvents = [...events];
    populateFilters();
    renderCalendar();
  } catch (error) {
    console.error('Erro ao carregar eventos:', error);
    alert('Erro ao carregar agenda. Verifique a conexÃ£o com o servidor.');
  }
}

// Atualize a funÃ§Ã£o saveEvent()
async function saveEvent() {
  const title = document.getElementById('eventTitle').value.trim();
  const professionalId = document.getElementById('eventProfessional').value;
  const procedureId = document.getElementById('eventProcedimento').value;
  const date = document.getElementById('eventDate').value;
  const time = document.getElementById('eventTime').value;
  const description = document.getElementById('eventDescription')?.value || title;

  // ValidaÃ§Ã£o
  if (!title || !professionalId || !procedureId || !date || !time) {
    alert('Por favor, preencha todos os campos obrigatÃ³rios!');
    return;
  }

  try {
    const response = await fetch('/api/agenda', { // Endpoint corrigido
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        title,
        professionalId: parseInt(professionalId),
        procedureId: parseInt(procedureId),
        date,
        time,
        description
      })
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || 'Erro ao salvar agendamento');
    }

    const savedEvent = await response.json();
    
    // Atualiza a interface
    events.push({
      ...savedEvent,
      professional: document.getElementById('eventProfessional').selectedOptions[0].text.split(' - ')[0]
    });
    
    filteredEvents = [...events];
    populateFilters();
    renderCalendar();
    
    // Fecha o modal
    document.getElementById('createEventModal').style.display = 'none';
    document.getElementById('eventForm').reset();
    
    alert('Agendamento criado com sucesso!');
  } catch (error) {
    console.error('Erro ao salvar agendamento:', error);
    alert(`Erro: ${error.message}`);
  }
}

async function loadFormData() {
  try {
    // Carrega profissionais
    const profResponse = await fetch('/api/profissionais');
    if (!profResponse.ok) throw new Error('Erro ao carregar profissionais');
    const profissionais = await profResponse.json();
    
    const profSelect = document.getElementById('eventProfessional');
    profSelect.innerHTML = '<option value="">Selecione...</option>';
    profissionais.forEach(prof => {
      const option = document.createElement('option');
      option.value = prof.id;
      option.textContent = `${prof.nome} - ${prof.especialidade}`;
      profSelect.appendChild(option);
    });
    
    // Carrega procedimentos
    const procResponse = await fetch('/api/procedimentos');
    if (!procResponse.ok) throw new Error('Erro ao carregar procedimentos');
    const procedimentos = await procResponse.json();
    
    const procSelect = document.getElementById('eventProcedimento');
    procSelect.innerHTML = '<option value="">Selecione...</option>';
    procedimentos.forEach(proc => {
      const option = document.createElement('option');
      option.value = proc.id;
      option.textContent = `${proc.DESCRPROC} (${proc.CODPROCED})`;
      procSelect.appendChild(option);
    });
    
  } catch (error) {
    console.error('Erro ao carregar dados:', error);
    alert('Erro ao carregar dados do formulÃ¡rio');
  }
}

// Adicione este listener para carregar dados quando o modal abre
document.querySelector('.new-event-btn').addEventListener('click', loadFormData);
  </script>
</body>
</html>